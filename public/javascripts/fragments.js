function create(){window.location.href="/fragments/new"}function edit(a){window.open("/fragments/"+a,"_blank")}function destroy(a){$["delete"]("/fragments/"+a,function(a){var b=$(".alert");b.find("strong").html(a.message),b.show().fadeIn(),datatables?datatables.draw():history.go(-1)})}function showAddAds(){$("#add-ad-modal").modal("show"),$("#ad-search-input").val(""),$("#ads-result-list").find("> ul").html("")}function saveAds(){var a=url(-1,window.location.href),b=$("#ads-result-list input[name=ads]:checked").map(function(){return $(this).val()}).get(),c=$("#ads-list-group input[name=ads]:checked").map(function(){return $(this).val()}).get();b=c.concat(b);var d=doT.template($("#ads-result").text()),e="/fragments/"+a+"/ads";$.post(e,{ads:b},function(a){$("#ads-list-group").html(d(a)),$("#add-ad-modal").modal("hide")})}function searchAds(){var a=($("#ads-list-select option:selected").val(),$("#ad-search-input").val());if($.trim(a).length<1)return!1;var b=doT.template($("#ads-tpl").text()),c="/api/ads/search/"+a+"/0";return $.get(c,function(a){$("#ads-result-list").find("ul").append(b(a))}),!0}var datatables,groupNames=void 0!==typeof groupNames?groupNames:[];$(document).ready(function(){var a=$("#main-datatables");a&&(datatables=a.DataTable({language:{url:"/javascripts/libs/datatables-chinese.json"},processing:!0,serverSide:!0,ajax:"/api/fragments",fnServerParams:function(a){var b=[],c=$("#group_filter").val();c&&c.length>0&&b.push({i:1,value:c}),a.filters=b},columns:[{name:"_id"},{name:"group"},{name:"desc"},{name:"order"}],columnDefs:[{targets:[4],render:function(a,b,c){return"<button onclick=\"edit('"+c[0]+'\')" class="btn btn-info">编辑</button>&nbsp;<button onclick="destroy(\''+c[0]+'\')" class="btn btn-danger">删除</button>'}}]})),$("#group_filter").change(function(){datatables.draw()});var b=$("#ads-list-group");b.length>0&&b.sortable({sort:!0,scroll:!0,animation:100,ghostClass:"sortable-ghost",onEnd:function(a){var b=[];$.each($(".list-group-item"),function(a,c){b.push({id:$(c).attr("data-id"),position:++a})});var c=$("#list_filter").val(),d="/fragments/"+c+"/sortable";$.post(d,{items:b},function(a){})}});var c=$("form input[name=group]");c.length>0&&c.typeahead({source:groupNames,autoSelect:!0})});