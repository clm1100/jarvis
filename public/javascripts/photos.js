function setup(){var a=$("#images-grid-container");return a.infinitescroll({debug:!1,behavior:"local",binder:a,extraScrollPx:100,navSelector:"#next",nextSelector:"#next a",dataType:"json",path:function(a){var b=$("#dir_filter").val(),c=(a-2)*imagesGridSize;return"/api/photos?start="+c+"&size="+imagesGridSize+"&dir="+b},appendCallback:!1},function(a,b){a.prefix=upyun;var c=doT.template($("#grid-page-tpl").text()),d=$(c(a)),e=$("#images-grid");e.append(d),imagesGrid?e.imagesLoaded(function(){imagesGrid.masonry("appended",d)}):imagesGrid=e.imagesLoaded(function(){e.masonry({itemSelector:".grid-item",isAnimated:!0})})})}function remove(a,b){var c=b+"/"+a,d="/api/photos";$.ajax({url:d,type:"DELETE",data:{path:c},success:function(b){if(200===b.statusCode){var c=$("#images-grid"),d="#"+removeExt(a);c.masonry("remove",$(d)).masonry("layout")}}})}function removeExt(a){return a.replace(/\.[^\/.]+$/,"")}var imagesGridSize=40,imagesGrid,upyun="http://dev.images.moretao.com";$(document).ready(function(){$("#images-grid-container");setup().scroll(),$("#dir_filter").change(function(){imagesGrid.masonry("destroy"),imagesGrid=null,$(".grid-item").remove();var a=$("#images-grid-container");a.infinitescroll("binding","unbind"),a.infinitescroll("destroy"),a.data("infinitescroll",null),setup().scroll()})});