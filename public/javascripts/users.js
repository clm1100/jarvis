function create(){window.location.href="/users/new"}function edit(a){window.open("/users/"+a,"_blank")}function destroy(a){BootstrapDialog.show({title:"此操作不可恢复!",message:"确认要删除这个用户吗?",buttons:[{label:"取消",action:function(a){a.close()}},{label:"删除",action:function(b){$.ajax({url:"/users/"+a,type:"DELETE",success:function(a){$(".alert strong").html(a.message),$(".alert").show().fadeIn(),b.close(),datatables?datatables.draw():history.go(-1)}})}}]})}function saveFavorite(){var a=url(-1,window.location.href),b=$("#favorite-id-input").val(),c=$("#favorite-name-input").val();if(!($.trim(c).length<1)){var d=$.map($("input[name=commodities]:checked"),function(a){return a.value}),e="/favorites";$.post(e,{id:b,uid:a,t:c,cids:d},function(a){$("#edit-favorite-modal").modal("hide"),location.reload()})}}function editFavorite(a){$("#commodity-result-list").find("ul").html(""),$("#edit-favorite-modal").modal("show");var b=$("#"+a).find("li");$("#favorite-id-input").val(a);var c=doT.template($("#commodities-tpl").text());$.each(b,function(a,b){if(b=$(b),0===a)$("#favorite-name-input").val(b.attr("data-t"));else{var d=c({items:[{id:b.attr("data-id"),t:b.attr("data-t")}],checked:!0});$("#commodity-result-list").find("ul").append(d)}})}function destroyFavorite(){var a=$("#favorite-id-input").val();!a||a.length<1||$.ajax({url:"/favorites/"+a,type:"DELETE",success:function(a){location.reload()}})}function getSubRegions(a){var b={};return $.ajax({type:"get",url:"/regions/"+a+"/subs",async:!1,success:function(a){$.each(a,function(a,c){b[c.code]={data:{c:c.code,n:c.name,p:c.parent}}})}}),b}function onAddressSelectChenge(a){for(var b=$("#address-form select"),c=0;c<b.length;c++)c+1>a&&$(b[c]).val("");var d={},e=$(b[0]).val(),f=$(b[1]).val();$(b[2]).val(),$(b[3]).val();if(1===a&&(d=all_regions[e].items),2===a&&(d=all_regions[e].items[f].items),3===a){var g=$(b[a-1]);d=getSubRegions(g.val())}var h=$(b[a]),i=[],j=h.find("option:first").html();i.push('<option value="">'+j+"</option>"),$.each(d,function(a){var b=d[a];i.push('<option value="'+b.data.c+'">'+b.data.n+"</option>")}),h.html(i.join(""))}function editAddress(a){$("#edit-address-modal-body").html("");var b=doT.template($("#address-tpl").text());if(a&&a.length>0)$.get("/addresses/"+a,function(a){var c=b(a);$("#edit-address-modal-body").html(c),$("#edit-address-modal").modal("show")});else{var c=b({});$("#edit-address-modal-body").html(c),$("#edit-address-modal").modal("show")}}function saveAddress(){var a=$("#address-form").serializeObject();if($.trim(a.province).length<1||$.trim(a.city).length<1)BootstrapDialog.show({message:"请填写必要的信息!"});else{var b="/addresses";$.post(b,a,function(a){location.reload()})}}function destroyAddress(){var a=$("#address-id-input").val();!a||a.length<1||$.ajax({url:"/addresses/"+a,type:"DELETE",success:function(a){location.reload()}})}function searchCommodities(){var a=$("#commodity-search-input").val();if($.trim(a).length<2)return!1;var b=doT.template($("#commodities-tpl").text()),c="/api/topics/search/"+a+"/0";return $.get(c,function(a){var c=b(a);$("#commodity-result-list").find("ul").append(c)}),!0}function searchTags(a){var b=$("#tag-search-input").val();if($.trim(b).length<1)return!1;var c=doT.template($("#tags-tpl").text()),d="/api/tags/search/"+a+"/"+b+"/0";return $.get(d,function(a){var b=c(a);$("#tag-result-list").find("ul").append(b)}),!0}function addTags(){var a=$("#tag-result-list").find("input[name=tags]:checked").map(function(a,b){return $(b).parent()}).get();$("#tags-list-group").append(a),$("#add-tag-modal").modal("hide")}var datatables,regions;$(document).ready(function(){var a=$("#main-datatables");a&&(datatables=a.DataTable({language:{url:"/javascripts/libs/datatables-chinese.json"},processing:!0,serverSide:!0,ajax:"/api/users",columns:[{name:"_id"},{name:"nickname"},{name:"mobile"},{name:"email"}],columnDefs:[{targets:[4],render:function(a,b,c){return"<button onclick=\"edit('"+c[0]+'\')" class="btn btn-info">编辑</button>&nbsp;<button onclick="destroy(\''+c[0]+'\')" class="btn btn-danger hide">删除</button>'}}]}));var b=$("#cover-input");if(b.length>0){new ImagePreview("#cover-input",{placeholder:"#cover-preview",height:"128px"})}});