function reset(){history.go(0)}function create(){window.location.href="/tabs/new"}function edit(a){window.open("/tabs/"+a,"_blank")}function sort(){var a=$("#type_filter").val();window.location.href="/tabs/sortable?num="+a}function destroy(a){$.ajax({url:"/tabs/"+a,type:"DELETE",success:function(a){$(".alert strong").html(a.message),$(".alert").show().fadeIn(),datatables?datatables.draw():history.go(-1)}})}function showAddAds(){$("#add-ad-modal").modal("show"),$("#ad-search-input").val(""),$("#ads-result-list").find("> ul").html("")}function saveAds(){var a=url(-1,window.location.href),b=$("#ads-result-list input[name=ads]:checked").map(function(){return $(this).val()}).get(),c=$("#ads-list-group input[name=ads]:checked").map(function(){return $(this).val()}).get();b=c.concat(b);var d=doT.template($("#ads-result").text()),e="/tags/"+a+"/ads";$.post(e,{ads:b},function(a){$("#ads-list-group").html(d(a)),$("#add-ad-modal").modal("hide")})}function searchAds(){var a=($("#ads-list-select option:selected").val(),$("#ad-search-input").val());if($.trim(a).length<1)return!1;var b=doT.template($("#ads-tpl").text()),c="/api/ads/search/"+a+"/0";return $.get(c,function(a){$("#ads-result-list").find("ul").append(b(a))}),!0}var datatables;$(document).ready(function(){var a=$("#main-datatables");a&&(datatables=a.DataTable({language:{url:"/javascripts/libs/datatables-chinese.json"},processing:!0,serverSide:!0,ajax:"/api/tabs",fnServerParams:function(a){var b=[],c=$("#type_filter").val();c&&c.length>0&&b.push({i:3,value:c});var d=$("#start_date_filter").val(),e=$("#end_date_filter").val(),f=moment(d,"YYYY年MM月DD日").format("MM/DD/YYYY"),g=moment(e,"YYYY年MM月DD日").format("MM/DD/YYYY");d&&d.length>0&&b.push({i:4,value:f}),e&&e.length>0&&b.push({i:5,value:g}),a.filters=b},columns:[{name:"_id"},{name:"t"},{name:"link"},{name:"type"},{name:"start"},{name:"end"}],columnDefs:[{targets:[5],render:function(a,b,c){return"<button onclick=\"edit('"+c[0]+"')\" class=\"btn btn-info\">编辑</button>&nbsp;<button onclick='destroy('"+c[0]+'\')" class="btn btn-danger">删除</button>'}}]}),$("#type_filter, #start_date_filter, #end_date_filter").change(function(){datatables.draw()}));var b=$("#cover-input");if(b.length>0){new ImagePreview("#cover-input",{placeholder:"#cover-preview",height:"128px",callback:function(){$("#show-cover-link").attr("href",$("#cover-preview").find("> img").attr("src"))}})}var c=$("#ads-list-group");c.length>0&&c.sortable({sort:!0,scroll:!0,animation:100,ghostClass:"sortable-ghost",onEnd:function(a){var b=[];$.each($(".list-group-item"),function(a,c){b.push({id:$(c).attr("data-id"),position:++a})});var c=$("#list_filter").val(),d="/tabs/"+c+"/sortable";$.post(d,{items:b},function(a){})}})});